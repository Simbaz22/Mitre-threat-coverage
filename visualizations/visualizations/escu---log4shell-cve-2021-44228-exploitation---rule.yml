title: ESCU - Log4Shell CVE-2021-44228 Exploitation - Rule
description: This correlation find exploitation of Log4Shell CVE-2021-44228 against
  systems using detections from Splunk Security Content Analytic Story. It does this
  by calculating the distinct count of MITRE ATT&CK tactics from Log4Shell detections
  fired. If the count is larger than 2 or more distinct MITRE ATT&CK tactics we assume
  high problability of exploitation. The Analytic story breaks down into 3 major phases
  of a Log4Shell exploitation, specifically> Initial Payload delivery eg. `${jndi:ldap://PAYLOAD_INJECTED}`
  Call back to malicious LDAP server eg. Exploit.class Post Exploitation Activity/Lateral
  Movement using Powershell or similar T1562.001 Each of these phases fall into different
  MITRE ATT&CK Tactics (Initial Access, Execution, Command and Control), by looking
  into 2 or more phases showing up in detections triggerd is how this correlation
  search finds exploitation. If we get a notable from this correlation search the
  best way to triage it is by investigating the affected systems against Log4Shell
  exploitation using Splunk SOAR playbooks.
status: Inactive
author: DS
logsource:
  product: Splunk
  service: splunkd
  category: Firewall
detection:
  condition:
    sigma: "\n  -  tstats `security_content_summariesonly` count min(_time) as firstTime\
      \ max(_time) as lastTime from datamodel=Risk.All_Risk where All_Risk.analyticstories=\"\
      Log4Shell CVE-2021-44228\" All_Risk.risk_object_type=\"system\" by All_Risk.risk_object\
      \ All_Risk.annotations.mitre_attack.mitre_tactic source \n  -  `drop_dm_object_name(All_Risk)`\
      \ \n  -  `security_content_ctime(firstTime)` \n  -  `security_content_ctime(lastTime)`\
      \ \n  -  stats values(risk_object) as affected_systems  values(source) as detection_name\
      \ values(annotations.mitre_attack.mitre_tactic) as tactics values(firstTime)\
      \ as firstTime values(lastTime) as lastTime dc(annotations.mitre_attack.mitre_tactic)\
      \ as distinct_tactics \n  -  where distinct_tactics >= 2 \n  -  `log4shell_cve_2021_44228_exploitation_filter`"
  level: critical
tags:
- "T1105\nT1190\nT1059"
- Ingress Tool Transfer
- Ingress Tool Transfer
references: .nan
notes: Activity already covered by network rules.
